{% extends "teacher/base_teacher.html" %}
{% load static %}
{% block title %}‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-6 py-10 space-y-8">

    <!-- Header -->
    <div class="flex items-center justify-between">
        <h1 class="text-2xl font-bold text-gray-900">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
        <a href="{% url 'teacher_lesson_history' %}" class="text-sm text-indigo-500 hover:underline">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</a>
    </div>

    <!-- Card -->
    <div class="bg-white rounded-xl shadow p-6 flex flex-col md:flex-row gap-6">
        {% with storybook.scenes.first.image_url as image %}
        <img src="{% if image %}{{ image }}{% else %}https://picsum.photos/seed/{{ storybook.id }}/400/200{% endif %}"
            class="w-full md:w-1/3 h-52 object-cover rounded-lg" />
        {% endwith %}

        <div class="flex-1 space-y-2">
            <h2 class="text-xl font-bold">{{ storybook.title }}</h2>
            <p class="text-sm text-gray-600">{{ storybook.lesson.classroom.name }}</p>
            <p class="text-sm text-gray-500">{{ storybook.lesson.classroom.description|default:"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢" }}</p>

            <div class="flex items-center gap-4 text-sm mt-2 text-gray-700">
                <span>üë• {{ total_submissions }} ‡∏Ñ‡∏ô‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                <span>‚≠ê 4.7 (750 ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß)</span>
            </div>

            <div class="flex flex-wrap gap-2 mt-3">
                <a href="#"
                    class="inline-flex items-center gap-2 bg-gray-100 text-gray-800 px-4 py-2 rounded hover:bg-gray-200">
                    <i class="fas fa-vial text-sm"></i><span>‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                </a>
                <a href="{% url 'detail_lesson' storybook.id %}"
                    class="inline-flex items-center gap-2 bg-gray-100 text-gray-800 px-4 py-2 rounded hover:bg-gray-200">
                    <i class="fas fa-pen-to-square text-sm"></i><span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>
                </a>
                <a href="{% url 'view_uploaded_lesson' storybook.id %}"
                    class="inline-flex items-center gap-2 bg-gray-100 text-gray-800 px-4 py-2 rounded hover:bg-gray-200">
                    <i class="fas fa-eye text-sm"></i><span>‡∏î‡∏π‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                </a>
                <a href="#"
                    class="inline-flex items-center gap-2 bg-gray-100 text-gray-800 px-4 py-2 rounded hover:bg-red-100 hover:text-red-700">
                    <i class="fas fa-trash-alt text-sm"></i><span>‡∏•‡∏ö‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                </a>
            </div>


        </div>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-center">
        <div class="bg-white p-4 rounded-xl shadow">
            <div class="text-xl font-bold">{{ total_submissions }}</div>
            <div class="text-sm text-gray-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</div>
        </div>
        <div class="bg-white p-4 rounded-xl shadow">
            <div class="text-xl font-bold">100</div>
            <div class="text-sm text-gray-500">‡∏¢‡∏≠‡∏î‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</div>
        </div>
        <div class="bg-white p-4 rounded-xl shadow">
            <div class="text-xl font-bold">{{ total_shares }}</div>
            <div class="text-sm text-gray-500">‡∏¢‡∏≠‡∏î‡πÅ‡∏ä‡∏£‡πå</div>
        </div>
        <div class="bg-white p-4 rounded-xl shadow">
            <div class="text-xl font-bold">{{ average_score|floatformat:1 }}/10</div>
            <div class="text-sm text-gray-500">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
        </div>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-xl shadow p-6 mt-6">
        <!-- Section Header -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
            <!-- Title -->
            <h2 class="text-xl font-semibold text-gray-900">
                ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </h2>

            <!-- Search and Sort -->
            <div class="flex items-center gap-2">
                <!-- Search -->
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤"
                        class="pl-10 pr-4 py-2 rounded-md bg-gray-50 border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                </div>

                <!-- Sort Dropdown -->
                <div>
                    <select
                        class="py-2 px-4 text-sm rounded-md border border-gray-200 bg-gray-50 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option>‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å : ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
                        <option>‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
                        <option>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î</option>
                        <option>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm">
                <thead class="bg-gray-100 text-gray-700">
                    <tr>
                        <th class="px-4 py-2">‡∏ä‡∏∑‡πà‡∏≠</th>
                        <th class="px-4 py-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                        <th class="px-4 py-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                        <th class="px-4 py-2">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for s in students %}
                    <tr>
                        <td class="px-4 py-2">{{ s.user.get_full_name|default:s.user.email }}</td>
                        <td class="px-4 py-2">{{ s.user.email }}</td>
                        <td class="px-4 py-2">{{ s.submitted_at|date:"j M Y" }}</td>
                        <td class="px-4 py-2 ">
                            <a href="{% url 'student_posttest_history' storybook.id s.user.id %}"
                                class="text-indigo-500 hover:underline">
                                <i class="fas fa-file-alt"></i>
                                {{ s.count }} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                            </a>
                        </td>

                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}